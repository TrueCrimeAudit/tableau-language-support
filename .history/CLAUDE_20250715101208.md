<TABLEAU_LSP_DEV_INSTRUCTION v="2.0">

<!-- ──  CORE PURPOSE ── -->
<purpose>
  Dev-side guide for the **Tableau Language Server Protocol (LSP)**
  VS Code extension.  
  Ensures every contributor and AI assistant can add or refactor language-server features
  safely, quickly, and in a Tableau-first, TypeScript-strict way.
</purpose>

<!-- ──  MANDATORY FILE DEPENDENCIES ── -->
<dependencies>
  <file src="syntaxes/functions.json"
        role="Single source-of-truth for Tableau function signatures, return types, docs.
              Hover & completion MUST read from this JSON." />
  <file src="syntaxes/twbl.tmLanguage.json"
        role="Authoritative TextMate grammar for .twbl syntax highlighting and semantic tokens." />
  <file src="syntaxes/twbl.d.twbl"
        role="Semantic token legend for LODs, window calculations, field types." />
</dependencies>

<!-- ──  FILE / FOLDER MAP ── -->
<code-map>
  <folder path="src/">
    Core LSP server and feature providers (diagnostics, hover, completion, signatureHelp, formatting, semantic tokens).
  </folder>
  <folder path="client/">
    VS Code extension activation and client logic.
  </folder>
  <folder path="syntaxes/">
    Tableau function catalog, TextMate grammar, semantic token legend.
  </folder>
  <folder path="snippets/">
    Code snippets and slash commands for Tableau calculations.
  </folder>
</code-map>

<!-- ──  MUST-WORK FEATURES ── -->
<features>
  Diagnostics, Hover, Completion, Signature Help, Go to Definition, Formatting, Semantic Tokens.
  All must work for `.twbl` files and derive from the dependencies above.
</features>

<!-- ──  "DONE" CHECKLIST ── -->
<done-checklist>
  - Diagnostics: Red squiggles update on each keystroke; Problems panel shows current issues only.
  - Hover: Shows function docs, field types, calculation previews from functions.json.
  - Completion: Context-aware suggestions; no duplicates; proper commit characters.
  - Signature Help: Triggers on `(` `,`; highlights active parameter; real-time updates.
  - Go to Definition: F12 jumps to field declarations; graceful fallback for external references.
  - Formatting: Ctrl+Shift+F works on full file and selections; preserves user intent.
  - Semantic Tokens: Proper highlighting for LODs, window functions, field references.
</done-checklist>

<!-- ──  LANGUAGE-SPECIFIC GUARANTEE ── -->
<tableau-only>
  <rule>
    Eliminate all references to AutoHotkey, Zig, or unrelated languages in docs, code, and tests.
    Use Tableau calculation syntax and `.twbl` grammar exclusively.
  </rule>
</tableau-only>

<!-- ──  CODING & BUILD CONVENTIONS ── -->
<conventions>
  - TypeScript strict mode: No `any` types, explicit return types for public methods.
  - ESLint compliance: Respect project rules.
  - Build: Use esbuild via `esbuild1.mjs`.
  - Error handling: Prefer graceful degradation; log errors for diagnostics.
