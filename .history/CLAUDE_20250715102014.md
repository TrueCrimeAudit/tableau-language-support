# Universal Principles for All Contributors and AI Assistants

These principles are mandatory for all development on this project, and must be followed in addition to the Tableau/LSP-specific rules below.

## 1. Mandatory Research & Tool Usage
- Always research official documentation and best practices before coding or refactoring.
- For complex tasks, use sequential/stepwise thinking: break down features, debugging, and architecture into concrete, ordered steps.
- Analyze recent git history and file-specific changes before modifying code.
- Always validate code (TypeScript/ESLint) before marking a task as complete.

## 2. Required Questions Before Implementation
- Always clarify user experience, configuration, integration, error handling, performance, security, and maintenance before starting.
- Never assume—explicitly ask about edge cases, constraints, and expectations.

## 3. Code Quality Standards
- Write clear, obvious code—no clever tricks.
- Use descriptive naming and comment only on the “why.”
- Each function should have a single responsibility.
- Handle errors explicitly and visibly.
- Optimize only after measuring performance.
- Keep code as simple as possible.

## 4. Honest Technical Assessment
- Always provide a candid assessment of limitations, risks, and tradeoffs.
- Quantify performance, security, and complexity impacts.
- If uncertain, state so explicitly.

## 5. Preserve Context and Documentation
- Retain technical context, rationale, and cross-references.
- Remove only redundant, obsolete, or decorative information.

## 6. Version Control and Commits
- Use Conventional Commits v1.0.0 for all changes.
- One logical change per commit, with context and references.
- Never mention “Claude” or “AI” in commit messages.

## 7. Development Workflow
- Always: Understand context → Research current state → Clarify → Research best practices → Plan steps → Execute → Validate → Commit.
- Use slash commands or equivalent for mapping, QA, refactoring, and debugging.

## 8. Technical Standards
- Follow strict TypeScript/ESLint conventions for naming, typing, and error handling.
- Plan in concrete steps, not timeframes.
- Enforce security best practices: never store secrets, always validate input, handle errors securely.

## 9. Implementation Patterns
- Use centralized, type-safe error handling.
- Prefer `unknown` over `any` in catch blocks.
- Measure, analyze, and document all performance optimizations.
- Ensure state management is single-source, immutable, and race-condition safe.

## 10. Core Principles
- Always use research and validation tools before coding.
- Never assume—always clarify.
- Write clear, honest, and maintainable code.
- Preserve context and rationale.
- Make atomic, well-documented commits.
- Test thoroughly before completion.
- Handle all errors explicitly.
- Treat user data as sacred.

---

<TABLEAU_LSP_DEV_INSTRUCTION v="2.0">

<!-- ──  CORE PURPOSE ── -->
<purpose>
  Dev-side guide for the **Tableau Language Server Protocol (LSP)**
  VS Code extension.  
  Ensures every contributor and AI assistant can add or refactor language-server features
  safely, quickly, and in a Tableau-first, TypeScript-strict way.
</purpose>

<!-- ──  MANDATORY FILE DEPENDENCIES ── -->
<dependencies>
  <file src="syntaxes/functions.json"
        role="Single source-of-truth for Tableau function signatures, return types, docs.
              Hover & completion MUST read from this JSON." />
  <file src="syntaxes/twbl.tmLanguage.json"
        role="Authoritative TextMate grammar for .twbl syntax highlighting and semantic tokens." />
  <file src="syntaxes/twbl.d.twbl"
        role="Semantic token legend for LODs, window calculations, field types." />
</dependencies>

<!-- ──  FILE / FOLDER MAP ── -->
<code-map>
  <folder path="src/">
    Core LSP server and feature providers (diagnostics, hover, completion, signatureHelp, formatting, semantic tokens).
  </folder>
  <folder path="client/">
    VS Code extension activation and client logic.
  </folder>
  <folder path="syntaxes/">
    Tableau function catalog, TextMate grammar, semantic token legend.
  </folder>
  <folder path="snippets/">
    Code snippets and slash commands for Tableau calculations.
  </folder>
</code-map>

<!-- ──  MUST-WORK FEATURES ── -->
<features>
  Diagnostics, Hover, Completion, Signature Help, Go to Definition, Formatting, Semantic Tokens.
  All must work for `.twbl` files and derive from the dependencies above.
</features>

<!-- ──  "DONE" CHECKLIST ── -->
<done-checklist>
  - Diagnostics: Red squiggles update on each keystroke; Problems panel shows current issues only.
  - Hover: Shows function docs, field types, calculation previews from functions.json.
  - Completion: Context-aware suggestions; no duplicates; proper commit characters.
  - Signature Help: Triggers on `(` `,`; highlights active parameter; real-time updates.
  - Go to Definition: F12 jumps to field declarations; graceful fallback for external references.
  - Formatting: Ctrl+Shift+F works on full file and selections; preserves user intent.
  - Semantic Tokens: Proper highlighting for LODs, window functions, field references.
</done-checklist>

<!-- ──  LANGUAGE-SPECIFIC GUARANTEE ── -->
<tableau-only>
  <rule>
    Eliminate all references to AutoHotkey, Zig, or unrelated languages in docs, code, and tests.
    Use Tableau calculation syntax and `.twbl` grammar exclusively.
  </rule>
</tableau-only>

<!-- ──  CODING & BUILD CONVENTIONS ── -->
<conventions>
  - TypeScript strict mode: No `any` types, explicit return types for public methods.
  - ESLint compliance: Respect project rules.
  - Build: Use esbuild via `esbuild1.mjs`.
  - Error handling: Prefer graceful degradation; log errors for diagnostics.
  - Performance: Async file I/O; incremental parsing for large documents.
  - Testing: Use Node `assert` + `ts-node` for tests.
</conventions>

<!-- ──  AI INTERACTION RULES ── -->
<assistant-behavior>
  ▸ Never reference AHK or Zig—swap for Tableau/.twbl.
  ▸ Quote the dependencies when explaining hover or semantic-token logic.
  ▸ Keep answers ≤ 300 words unless deeper detail is requested.
  ▸ Use ```ts, ```json, or ```xml fences for code/document examples.
  ▸ When fixing bugs or adding features, use patch format:
    ```typescript
    // src/diagnosticsProvider.ts
    @@ before
    // old code here
    @@ after
    // new code here
    // Brief 1-line rationale
    ```
  ▸ Ask for missing context if needed; focus on LSP request/response cycle.
  ▸ Reference the three critical dependency files when relevant.
  ▸ No theory dumps—skip architectural explanations unless specifically requested.
</assistant-behavior>

<!-- ──  WORKFLOW ── -->
<workflow>
  1. Debug: Use VS Code extension host (F5) for live testing.
  2. Build: `npm run build` via esbuild.
  3. Test: Use `.twbl` files in repo root for validation.
  4. LSP tracing: Enable `"tableau-lsp.trace.server": "verbose"` in VS Code settings.
</workflow>

</TABLEAU_LSP_DEV_INSTRUCTION>
